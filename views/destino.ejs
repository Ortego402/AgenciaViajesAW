<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="../css/destino.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <title>EpicScape-<%= result.nombre %></title>
    <link rel="icon" href="../images/logo.png" type="image/x-icon">
</head>
<body>
    <header class="container-fluid">
        <div class="col col-4 d-flex justify-content-center align-items-center">
          <a href="/" class="btn btn-primary btn-block" style="background-color:rgb(249, 54, 44); color: #333; border: none;">
            <h2><strong>EpicScape</strong></h2>
          </a>
        </div>
        <div class="col col-4">
          <form action="/buscar" method="get">
            <div class="buscador">
              <input id="busquedaGlobal" type="search" class="caja" placeholder="Próximo destino..." name="nombreBuscar" required>
              <button class="boton" type="submit"><i class="bi bi-search"></i></button>
            </div>
          </form>
        </div>
        <div class="col col-4 d-flex justify-content-center align-items-center">
            <img src="../images/logo.png" class="img" alt="Imagen sustitutiva de login">
        </div>
    </header>

    <nav class="navbar">
        <a href="#" class="botonnav">Nosotros</a>
        <a href="#" class="botonnav">Servicios</a>
        <a href="#" class="botonnav">Contacto</a>
    </nav>

    <main>
        <% if (reservaConfirmada) { %>
            <div class="alert alert-success" role="alert" style="background-color: rgb(113, 251, 141); color: black;">
                ¡Reserva confirmada! Gracias por tu reserva.
            </div>
        <% } else if (comentarioConfirmado) { %>
            <div class="alert alert-success" role="alert" style="background-color: rgb(113, 251, 141); color: black;">
                ¡Comentario publicado!
            </div>
        <% } else if(reservaConfirmada != "" && comentarioConfirmado != "") { %>
            <div class="alert alert-danger" role="alert" style="background-color: rgb(255, 92, 92); color: white;">
                ¡Ups! No se pudo realizar la acción debido a un fallo. Por favor, inténtalo de nuevo más tarde.
            </div>
        <% } %>        
        <div class="border-bottom">
            <h2 class="titulo-dest"><strong><%= result.nombre %></strong></h2>
        </div>
        <div class="destino-container">
            <div class="row mx-n2">
                <div class="col-md-2">
                    <br>
                </div>
                <div class="col-md-4 d-flex justify-content-center align-items-center mt-3">
                    <div class="border border-end">
                        <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <% results.forEach((imagen, index) => { %>
                                    <div class="rounded carousel-item <%= index === 0 ? 'active' : '' %>">
                                        <img src="<%= imagen.url %>" class="img-mediana" alt="<%= result.nombre %>">
                                    </div>
                                <% }); %>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <br>
                </div>
                <div class="col-md-4 d-flex justify-content-center align-items-center mt-3">
                    <div class="destino-info bg-secondary p-4 bg-opacity-25 mx-auto rounded d-flex flex-column">
                        <p class="desc"><%= result.descripcion %></p>
                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <h4 class="price end-0 mb-0">Por solamente: <%= result.precio %>€</h4>
                            <button onclick="mostrarPopup()" type="button" class="reservar-btn mt-auto btn btn-danger px-3 py-3">Reservar</button>
                        </div>
                    </div>
                
                    <!-- Contenido de la ventana emergente -->
                    <div class="popup-container" id="popup">
                        <div class="popup-content">
                            <form action="/destino/<%= result.id %>/reservar" method="post" class="general" onsubmit="return validarFormulario()">
                                <label for="nombre">Nombre:</label>
                                <input type="text" id="nombre" name="nombre" required><br><br>
                            
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email" required><br><br>
                            
                                <label for="fecha_llegada">Fecha de reserva:</label>
                                <input type="date" id="fecha_reserva" name="fecha_reserva" required><br><br>
                            
                                <div class="button-container">
                                    <button type="submit" class="botonconfirmar">Confirmar</button>
                                    <button type="button" onclick="cerrarPopup()" class="cerrar-btn">Cerrar</button>
                                </div>
                            </form>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>   
        <div class="comentario-form m-3">
            <h5>Deja un comentario:</h5>
            <form action="/destino/<%= result.id %>/comentarios" method="post" th:object="${comentario}">
                <input type="hidden" th:field="*{destinoId}" th:value="${result.id}" />
                <div class="mb-3">
                    <label for="nombre_usuario" class="form-label">Nombre:</label>
                    <input type="text" class="form-control" id="nombre_usuario" name="nombre_usuario" required>
                </div>                
                <div class="mb-3">
                    <label for="comentario" class="form-label">Comentario:</label>
                    <textarea class="form-control" id="comentario" name="comentario" rows="1" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Enviar comentario</button>
            </form>
        </div>
        <div class="comentarios-lista m-3">
            <h5>Comentarios:</h5>
            <% comentarios.forEach(function(comentario) { %>
                <div class="comentario border border-dark">
                    <p class="comentario-text">
                        <strong><%= comentario.nombre_usuario %>:</strong> <%= comentario.comentario %>
                        <br>
                        <small class="fecha-comentario"><%= comentario.fecha_comentario %></small>
                    </p>
                </div>
            <% }); %>
        </div>
               
    </main>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Función para mostrar la ventana emergente
        function mostrarPopup() {
            document.getElementById('popup').style.display = 'block';
        }
    
        // Función para cerrar la ventana emergente
        function cerrarPopup() {
            document.getElementById('popup').style.display = 'none';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-lightbox@0.7.0/dist/bootstrap-lightbox.min.js"></script>
</body>
</html>